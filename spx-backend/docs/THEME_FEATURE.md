# SVG生成主题功能文档

## 概述

SVG生成主题功能为图片生成提供了预定义的风格主题，通过在提示词中自动添加主题相关的风格描述，确保生成的图片严格遵循指定的视觉风格。

## 功能特性

- **9种预定义主题**：涵盖卡通、写实、极简等多种风格
- **严格风格控制**：使用强制性指令词汇确保AI严格遵循风格要求
- **自动提示词增强**：后端自动将主题提示词拼接到用户原始提示词
- **主题查询API**：前端可动态获取所有可用主题信息
- **中文支持**：提供中文名称、描述和提示词

## 支持的主题

### 1. 无主题 (ThemeNone)
- **ID**: `""`
- **中文名**: 无主题
- **描述**: 不应用任何特定主题风格
- **提示词**: 无

### 2. 卡通风格 (ThemeCartoon)
- **ID**: `"cartoon"`
- **中文名**: 卡通风格
- **描述**: 色彩鲜艳的卡通风格，适合可爱有趣的内容
- **提示词**: 必须使用卡通风格，必须色彩鲜艳丰富，必须可爱有趣，严格使用简单几何形状，强制使用明亮饱和的色彩，禁止写实细节

### 3. 写实风格 (ThemeRealistic)
- **ID**: `"realistic"`
- **中文名**: 写实风格
- **描述**: 高度写实的风格，细节丰富逼真
- **提示词**: 必须使用写实风格，严格要求高度细节化，强制逼真效果，必须专业高质量渲染，禁止卡通化或简化元素

### 4. 极简风格 (ThemeMinimal)
- **ID**: `"minimal"`
- **中文名**: 极简风格
- **描述**: 极简主义风格，简洁干净的设计
- **提示词**: 必须使用极简风格，严格限制元素数量，强制使用干净线条和几何形状，严格使用黑白或单色调，禁止复杂装饰

### 5. 奇幻风格 (ThemeFantasy)
- **ID**: `"fantasy"`
- **中文名**: 奇幻风格
- **描述**: 充满魔法和超自然元素的奇幻风格
- **提示词**: 必须使用奇幻魔法风格，强制添加神秘魔法元素，严格使用梦幻色彩，必须包含超自然效果，禁止现实主义元素

### 6. 复古风格 (ThemeRetro)
- **ID**: `"retro"`
- **中文名**: 复古风格
- **描述**: 怀旧复古风格，经典老式美学
- **提示词**: 必须使用复古怀旧风格，严格遵循经典老式美学，强制使用怀旧色调和设计元素，禁止现代化元素

### 7. 科幻风格 (ThemeScifi)
- **ID**: `"scifi"`
- **中文名**: 科幻风格
- **描述**: 未来科技风格，充满科幻元素
- **提示词**: 必须使用科幻未来风格，强制添加科技元素，严格使用霓虹和金属色彩，必须包含未来感设计，禁止传统元素

### 8. 自然风格 (ThemeNature)
- **ID**: `"nature"`
- **中文名**: 自然风格
- **描述**: 自然有机风格，使用自然元素和大地色调
- **提示词**: 必须使用自然有机风格，严格使用自然元素和植物，强制使用大地色调和绿色系，禁止人工几何元素

### 9. 商务风格 (ThemeBusiness)
- **ID**: `"business"`
- **中文名**: 商务风格
- **描述**: 专业商务风格，现代企业形象
- **提示词**: 必须使用商务专业风格，严格保持企业形象，强制使用现代简洁设计，必须专业精致，禁止卡通或娱乐元素

## API接口

### 1. 查询所有主题

**接口地址**: `GET /themes`

**响应格式**:
```json
[
  {
    "id": "cartoon",
    "name": "卡通风格",
    "description": "色彩鲜艳的卡通风格，适合可爱有趣的内容",
    "prompt": "必须使用卡通风格，必须色彩鲜艳丰富，必须可爱有趣，严格使用简单几何形状，强制使用明亮饱和的色彩，禁止写实细节"
  }
  // ... 其他主题
]
```

### 2. 生成SVG（支持主题）

**接口地址**: `POST /image/svg`

**请求参数**:
```json
{
  "prompt": "一只可爱的小猫",
  "theme": "cartoon",
  "provider": "svgio"
}
```

**处理流程**:
1. 验证主题参数是否有效
2. 应用主题提示词：`"一只可爱的小猫，必须使用卡通风格，必须色彩鲜艳丰富..."`
3. 调用图片生成服务
4. 返回生成的SVG内容

### 3. 生成图片元数据（支持主题）

**接口地址**: `POST /image`

**请求参数**: 与生成SVG相同

**响应**: 返回图片元数据信息，包含URL、尺寸等

## 实现细节

### 核心文件

1. **`internal/controller/theme.go`**
   - 定义主题类型和常量
   - 提供主题信息映射
   - 实现提示词拼接逻辑
   - 提供主题查询方法

2. **`internal/controller/svg.go`**
   - 集成主题功能到生成接口
   - 添加主题查询controller方法

3. **`cmd/spx-backend/get_themes.yap`**
   - 主题查询API端点

### 核心方法

#### 1. 主题验证
```go
func IsValidTheme(theme ThemeType) bool
```

#### 2. 提示词拼接
```go
func ApplyThemeToPrompt(originalPrompt string, theme ThemeType) string
```

#### 3. 主题信息查询
```go
func GetAllThemesInfo() []ThemeInfo
func GetThemeInfo(theme ThemeType) ThemeInfo
```

### 提示词设计原则

1. **强制性指令**: 使用"必须"、"严格"、"强制"等命令性词汇
2. **明确要求**: 详细描述每个主题的具体视觉特征
3. **禁止条款**: 明确禁止与主题不符的元素
4. **中文优化**: 使用中文逗号拼接，符合中文表达习惯

## 使用示例

### 前端获取主题列表
```javascript
fetch('/themes')
  .then(response => response.json())
  .then(themes => {
    themes.forEach(theme => {
      console.log(`${theme.name}: ${theme.description}`);
    });
  });
```

### 前端生成图片
```javascript
const request = {
  prompt: "一座美丽的城堡",
  theme: "fantasy",
  provider: "svgio"
};

fetch('/image/svg', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify(request)
});
```

### 实际处理效果
- **原始提示词**: "一座美丽的城堡"
- **应用奇幻主题后**: "一座美丽的城堡，必须使用奇幻魔法风格，强制添加神秘魔法元素，严格使用梦幻色彩，必须包含超自然效果，禁止现实主义元素"

## 测试覆盖

项目包含完整的单元测试，覆盖以下功能：

1. 主题验证逻辑
2. 提示词拼接功能
3. 主题信息查询
4. 参数验证

测试文件: `internal/controller/theme_test.go`

## 扩展性

### 添加新主题

1. 在 `ThemeType` 中定义新常量
2. 在 `ThemePrompts` 中添加提示词
3. 在 `ThemeNames` 中添加中文名称
4. 在 `ThemeDescriptions` 中添加描述
5. 更新 `GetAvailableThemes()` 方法
6. 添加对应的测试用例

### 主题定制

可以通过修改 `ThemePrompts` 中的提示词来调整主题效果，或者添加更细粒度的主题参数控制。

## 注意事项

1. 主题功能会修改用户的原始提示词，在日志中会记录修改前后的内容
2. 无主题选项 (`ThemeNone`) 不会修改原始提示词
3. 主题验证在参数验证阶段进行，无效主题会返回错误
4. 所有主题信息通过API动态获取，支持后端热更新