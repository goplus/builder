<script lang="ts" setup>
import { computed } from 'vue'

import { Round, RoundState } from '../copilot'

const props = defineProps<{
  round: Round
  isLastRound: boolean
}>()

const retryable = computed(() => {
  return props.isLastRound && [RoundState.Cancelled, RoundState.Failed].includes(props.round.state)
})

function handleRetry() {
  props.round.retry()
}
</script>

<template>
  <div class="retryable-wrapper">
    <div class="tip">
      <slot />
    </div>
    <button v-if="retryable" class="retry" @click="handleRetry">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
        <path
          d="M11.6107 3.44482C11.8473 3.44482 12.0304 3.44304 12.1928 3.46436C13.2398 3.6022 14.0646 4.42616 14.2025 5.47314C14.2239 5.63566 14.2221 5.8194 14.2221 6.05615V9.22217C14.2221 9.67751 14.2221 10.0594 14.1967 10.3706C14.1706 10.6897 14.1148 10.9939 13.9682 11.2817C13.7445 11.7206 13.3875 12.0776 12.9486 12.3013C12.6607 12.448 12.3566 12.5047 12.0375 12.5308C11.7263 12.5562 11.3445 12.5562 10.8891 12.5562H8.49844L9.02676 13.0845C9.28688 13.3448 9.28703 13.7666 9.02676 14.0269C8.76649 14.2871 8.34473 14.2869 8.08438 14.0269L6.41739 12.3608C6.15706 12.1005 6.1571 11.6778 6.41739 11.4175L8.08438 9.75146C8.34473 9.49112 8.76641 9.49112 9.02676 9.75146C9.28686 10.0118 9.28703 10.4336 9.02676 10.6938L8.49844 11.2222H10.8891C11.3664 11.2222 11.6847 11.2216 11.9291 11.2017C12.1656 11.1823 12.2746 11.1477 12.3432 11.1128C12.5311 11.0169 12.6839 10.8642 12.7797 10.6763C12.8146 10.6077 12.8492 10.4995 12.8686 10.2632C12.8885 10.0188 12.8891 9.69973 12.8891 9.22217V6.05615C12.8891 5.7782 12.8873 5.70196 12.8803 5.64795C12.8212 5.19922 12.4677 4.8457 12.019 4.78662C11.9649 4.77955 11.8893 4.77783 11.6107 4.77783C11.2427 4.77764 10.9448 4.47889 10.9447 4.11084C10.9449 3.74289 11.2428 3.44501 11.6107 3.44482ZM6.97305 1.97314C7.23335 1.71284 7.65507 1.71294 7.91544 1.97314L9.58243 3.64014C9.84258 3.9005 9.84271 4.32224 9.58243 4.58252L7.91544 6.24951C7.65512 6.50941 7.23329 6.50953 6.97305 6.24951C6.71271 5.98917 6.71273 5.5665 6.97305 5.30615L7.50137 4.77783H5.11075C4.63325 4.77783 4.31512 4.77837 4.07071 4.79834C3.83479 4.81762 3.72627 4.85139 3.65762 4.88623C3.46959 4.98205 3.316 5.13574 3.22012 5.32373C3.18522 5.39236 3.15056 5.50147 3.13126 5.73779C3.11132 5.98221 3.11075 6.30042 3.11075 6.77783V9.94482C3.11075 10.2235 3.11244 10.299 3.11954 10.353C3.17878 10.8016 3.53227 11.1553 3.98087 11.2144C4.0349 11.2214 4.11056 11.2222 4.38907 11.2222C4.75716 11.2223 5.05606 11.521 5.05606 11.8892C5.05589 12.2571 4.75705 12.556 4.38907 12.5562C4.15226 12.5562 3.9686 12.557 3.80606 12.5356C2.75938 12.3976 1.93625 11.5735 1.79825 10.5269C1.7769 10.3645 1.77774 10.1813 1.77774 9.94482V6.77783C1.77774 6.32215 1.77672 5.93977 1.80215 5.62842C1.82824 5.30942 1.886 5.00604 2.03262 4.71826C2.25633 4.27942 2.61327 3.92237 3.05215 3.69873C3.33991 3.55219 3.64335 3.49531 3.96231 3.46924C4.27354 3.44383 4.65534 3.44482 5.11075 3.44482H7.50137L6.97305 2.91553C6.71287 2.65519 6.71281 2.23345 6.97305 1.97314Z"
          fill="currentColor"
        />
      </svg>
      {{ $t({ en: 'Retry', zh: '重试' }) }}
    </button>
  </div>
</template>

<style lang="scss" scoped>
.retryable-wrapper {
  display: flex;
  flex-direction: column;
  gap: 8px;
  font-size: 12px;
  line-height: 18px;
}

.tip {
  display: flex;
  align-items: center;
  gap: 8px;
}

.retry {
  margin-left: 24px;
  padding: 3px 0px;
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: inherit;
  line-height: 18px;
  width: fit-content;
  border: none;
  background: none;
  cursor: pointer;
  color: var(--ui-color-grey-800);
  border-radius: 4px;
  transition: 0.2s;

  &:hover {
    color: var(--ui-color-grey-700);
  }
  &:active {
    color: var(--ui-color-grey-900);
  }
}
</style>
