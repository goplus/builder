<template>
  <div class="ai-generate-dialog">
    <!-- 遮罩层 -->
    <div 
      v-if="visible" 
      class="dialog-overlay"
      @click="handleCancel"
    >
      <!-- 弹窗主体 -->
      <div 
        class="dialog-content"
        @click.stop
      >
        <!-- 标题栏 -->
        <div class="dialog-header">
          <h3 class="dialog-title">AI生成图片</h3>
          <button 
            class="close-btn"
            @click="handleCancel"
          >
            ×
          </button>
        </div>

        <!-- 内容区域 -->
        <div class="dialog-body">
          <div class="dialog-content-wrapper">
            <!-- 左侧表单区域 -->
            <div class="form-section">
              <!-- 模型选择 -->
              <div class="form-group">
                <label class="form-label">选择生成模型</label>
                <div class="model-selector">
                  <div 
                    class="model-option"
                    :class="{ active: selectedModel === 'png' }"
                    @click="selectedModel = 'png'"
                  >
                    <div class="model-icon">🖼️</div>
                    <div class="model-info">
                      <div class="model-name">PNG图片</div>
                      <div class="model-desc">生成高质量位图图片</div>
                    </div>
                  </div>
                  <div 
                    class="model-option"
                    :class="{ active: selectedModel === 'svg' }"
                    @click="selectedModel = 'svg'"
                  >
                    <div class="model-icon">📐</div>
                    <div class="model-info">
                      <div class="model-name">SVG矢量</div>
                      <div class="model-desc">生成可缩放矢量图形</div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 提示词输入 -->
              <div class="form-group">
                <label class="form-label">描述您想要的图片</label>
                <textarea
                  v-model="prompt"
                  class="prompt-input"
                  placeholder="请详细描述您想要生成的图片内容，例如：一只可爱的卡通猫咪，坐在彩虹上，背景是蓝天白云..."
                  rows="4"
                ></textarea>
                <div class="input-hint">
                  提示：描述越详细，生成的图片效果越好
                </div>
              </div>

              <!-- 生成按钮 -->
              <div class="form-group">
                <button 
                  class="generate-btn"
                  :disabled="!prompt.trim() || isGenerating"
                  @click="handleGenerate"
                >
                  <span v-if="isGenerating" class="loading-spinner"></span>
                  {{ isGenerating ? '生成中...' : '生成图片' }}
                </button>
              </div>
            </div>

            <!-- 右侧预览区域 -->
            <div class="preview-section" :class="{ visible: previewUrl || isGenerating }">
              <label class="form-label">预览效果</label>
              <div class="preview-container">
                <div v-if="isGenerating" class="preview-loading">
                  <div class="loading-spinner large"></div>
                  <div class="loading-text">AI正在为您生成图片...</div>
                </div>
                <div v-else-if="previewUrl" class="preview-image-wrapper">
                  <img 
                    :src="previewUrl" 
                    alt="AI生成的图片预览"
                    class="preview-image"
                    @load="handleImageLoad"
                    @error="handleImageError"
                  />
                  <!-- <div class="preview-info">
                    <span class="model-tag">{{ selectedModel.toUpperCase() }}</span>
                    <span class="size-info">{{ imageSize }}</span>
                  </div> -->
                </div>
                <div v-else class="preview-placeholder">
                  <div class="placeholder-icon">🖼️</div>
                  <div class="placeholder-text">生成的图片将在这里预览</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 底部按钮 -->
        <div class="dialog-footer">
          <button 
            class="btn btn-secondary"
            @click="handleCancel"
          >
            取消
          </button>
          <button 
            class="btn btn-primary"
            :disabled="!previewUrl || isGenerating"
            @click="handleConfirm"
          >
            确认使用
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'

// Props
interface Props {
  visible: boolean
}

const props = withDefaults(defineProps<Props>(), {
  visible: false
})

// Emits
const emit = defineEmits<{
  'update:visible': [value: boolean]
  'confirm': [data: { 
    model: string; 
    prompt: string; 
    url?: string; 
    svgContent?: string;
  }]
  'cancel': []
}>()

// 响应式数据
const selectedModel = ref<'png' | 'svg'>('png')
const prompt = ref('')
const previewUrl = ref('')
const isGenerating = ref(false)
const imageSize = ref('')

// 存储SVG原始代码
const svgRawContent = ref('')

// 方法
const handleGenerate = async () => {
  if (!prompt.value.trim()) return
  
  isGenerating.value = true
  previewUrl.value = ''
  
  try {
    // TODO: 这里需要调用实际的AI生成API
    // 目前使用模拟数据
    await simulateGeneration()
    
    // 模拟生成结果
    previewUrl.value = generateMockImageUrl()
    imageSize.value = selectedModel.value === 'png' ? '512x512' : '矢量图'
    
  } catch (error) {
    console.error('生成图片失败:', error)
    // TODO: 显示错误提示
  } finally {
    isGenerating.value = false
  }
}

const handleConfirm = () => {
  if (!previewUrl.value) return
  
  const confirmData: any = {
    model: selectedModel.value,
    prompt: prompt.value
  }
  
  if (selectedModel.value === 'svg') {
    // SVG模式：传递原始SVG代码
    confirmData.svgContent = svgRawContent.value
    confirmData.url = previewUrl.value // 用于预览的blob URL
    // console.log('SVG确认数据:', { svgContent: svgRawContent.value })
  } else {
    // PNG模式：传递图片URL
    confirmData.url = previewUrl.value
    // console.log('PNG确认数据:', { url: previewUrl.value })
  }
  
  emit('confirm', confirmData)
  
  handleCancel()
}

const handleCancel = () => {
  emit('update:visible', false)
  emit('cancel')
  
  // 重置状态
  setTimeout(() => {
    prompt.value = ''
    previewUrl.value = ''
    isGenerating.value = false
    selectedModel.value = 'png'
  }, 300)
}

const handleImageLoad = () => {
//   console.log('图片加载成功')
}

const handleImageError = () => {
  console.error('图片加载失败')
  previewUrl.value = ''
}

// 模拟生成过程
const simulateGeneration = () => {
  return new Promise(resolve => {
    setTimeout(resolve, 2000) // 模拟2秒生成时间
  })
}

// 生成模拟图片URL
const generateMockImageUrl = () => {
  if (selectedModel.value === 'svg') {
    // SVG模拟数据 - 一个简单的彩色图形
    const svgContent = `<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
 width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000"
 preserveAspectRatio="xMidYMid meet">
<metadata>
Created by potrace 1.16, written by Peter Selinger 2001-2019
</metadata>
<g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
fill="#000000" stroke="none">
<path d="M3090 4524 c-226 -29 -420 -114 -628 -277 -116 -90 -170 -146 -248
-257 -29 -41 -67 -84 -84 -95 -39 -25 -94 -105 -154 -221 -59 -116 -102 -166
-172 -200 -104 -51 -200 -30 -309 69 -60 53 -143 107 -164 107 -9 -1 2 -10 24
-22 22 -11 79 -58 126 -103 66 -64 97 -86 139 -100 123 -41 237 12 347 161 26
35 48 62 50 60 8 -8 -72 -158 -104 -195 -42 -50 -110 -83 -187 -91 l-61 -6 35
-12 c31 -11 26 -11 -46 -8 -47 2 -94 11 -112 20 -17 9 -59 50 -93 92 -35 42
-84 90 -109 107 l-45 31 50 -55 c28 -30 70 -83 94 -117 62 -87 120 -115 254
-120 125 -5 172 11 242 83 52 54 64 75 163 287 55 115 110 206 161 266 26 30
31 28 20 -10 -14 -50 -10 -107 11 -168 11 -30 19 -81 20 -112 0 -47 -4 -62
-27 -89 -44 -52 -139 -78 -172 -46 -11 10 -12 8 -3 -9 27 -51 117 -56 178 -9
69 52 92 135 69 244 -21 103 -19 149 11 208 30 62 132 168 216 225 60 40 229
124 297 147 44 14 44 15 -65 -57 -180 -118 -348 -288 -380 -384 -17 -53 -13
-102 11 -134 14 -18 14 -17 5 9 -31 88 -1 157 130 291 111 114 188 170 355
259 90 49 121 60 173 64 63 6 82 -6 44 -26 -33 -17 -132 -127 -193 -211 -79
-110 -166 -257 -271 -455 -164 -308 -225 -388 -356 -469 -65 -41 -78 -60 -20
-30 153 77 291 231 447 494 41 69 95 159 120 200 163 265 368 460 594 563 42
20 77 40 77 46 0 10 -26 19 -120 41 -49 11 -284 21 -340 14z m208 -60 c18 -5
20 -9 10 -21 -22 -27 -67 -43 -167 -58 -56 -8 -102 -15 -104 -15 -2 0 -3 20
-3 45 1 39 4 45 26 48 42 7 214 7 238 1z m-378 -67 c0 -25 -35 -47 -138 -87
-160 -62 -231 -102 -347 -193 -37 -29 -30 -20 28 37 96 93 220 177 329 222 88
36 128 42 128 21z"/>
<path d="M3698 4440 c-127 -23 -236 -69 -344 -145 -177 -126 -391 -434 -402
-578 -4 -46 -1 -62 13 -77 38 -42 102 -13 146 65 17 30 32 55 33 55 1 0 -5
-31 -15 -68 -9 -38 -20 -131 -24 -208 -11 -247 -44 -370 -135 -504 -79 -117
-196 -217 -336 -288 -101 -51 -166 -65 -270 -60 -80 4 -103 10 -168 41 -42 20
-76 40 -76 44 0 4 44 21 98 36 107 31 221 83 267 121 29 25 27 24 -74 -10 -58
-19 -155 -46 -216 -59 -211 -45 -292 -92 -344 -196 -25 -50 -31 -75 -31 -126
0 -74 15 -115 59 -166 86 -97 248 -140 382 -101 137 41 379 197 527 341 l97
94 -96 -79 c-104 -86 -219 -166 -286 -201 -60 -30 -63 -26 -10 14 92 70 70 77
-34 10 -118 -75 -191 -105 -269 -111 l-55 -5 47 19 c26 11 80 41 120 68 l73
49 -38 3 c-29 3 -50 -4 -85 -27 -100 -64 -177 -77 -242 -42 -40 21 -90 106
-90 152 0 37 25 97 52 126 l21 22 27 -43 c57 -89 167 -155 276 -164 78 -6 147
10 249 58 102 47 182 108 286 217 46 49 99 95 121 105 21 10 76 44 121 77 191
138 394 250 562 310 174 63 225 83 230 90 2 5 -26 -2 -63 -15 -37 -12 -109
-34 -161 -49 -118 -32 -241 -92 -401 -193 -69 -44 -126 -78 -128 -77 -2 2 5
20 16 42 11 21 50 117 87 213 111 287 167 384 282 490 37 34 98 80 136 102 84
50 102 74 21 29 -87 -49 -142 -91 -210 -163 -114 -119 -187 -250 -274 -497
-47 -133 -85 -221 -95 -221 -3 0 4 19 16 41 40 79 88 249 119 416 58 317 128
468 282 608 91 82 172 118 275 123 71 3 89 1 136 -21 98 -45 179 -135 219
-245 16 -44 21 -81 21 -162 1 -106 -12 -172 -50 -257 l-18 -39 -1 61 c-2 142
-101 264 -245 301 -150 39 -306 -40 -381 -193 -28 -57 -32 -77 -34 -157 -2
-90 -2 -91 5 -21 12 116 72 204 173 254 150 75 322 6 374 -151 24 -72 16 -187
-17 -258 -40 -86 -79 -123 -238 -221 -182 -113 -316 -211 -451 -328 -127 -111
-322 -248 -571 -404 -300 -188 -419 -242 -583 -270 l-79 -13 56 -14 c78 -18
116 -44 135 -90 10 -22 19 -40 22 -40 3 0 28 15 55 33 39 25 51 40 58 70 l9
39 39 -58 c46 -69 56 -113 69 -299 8 -115 32 -245 44 -245 2 0 1 42 -2 93 -4
81 0 111 28 231 33 137 33 138 23 274 -5 76 -6 141 -2 146 5 6 9 -25 9 -70 l0
-79 19 31 c14 23 34 36 73 49 110 36 210 108 488 355 183 162 210 183 323 254
155 97 314 146 544 167 297 27 446 -50 534 -274 l26 -69 13 51 c52 217 -47
339 -310 381 -136 21 -355 8 -510 -31 -109 -27 -261 -107 -394 -205 -65 -48
-119 -84 -122 -81 -13 13 232 208 415 330 95 64 116 74 125 62 21 -29 102 -34
264 -18 144 15 161 15 256 -2 194 -34 206 -32 206 32 0 45 -49 192 -94 280
-34 69 -125 198 -133 189 -2 -2 21 -53 51 -113 72 -140 72 -146 2 -138 -63 8
-145 -7 -234 -42 -35 -14 -65 -23 -68 -21 -2 3 14 17 36 32 56 37 114 90 152
140 25 32 20 29 -23 -16 -61 -61 -114 -98 -143 -98 -15 0 -10 9 23 45 167 182
264 504 217 725 -40 190 -154 322 -334 387 -74 27 -197 37 -274 23z m204 -126
c108 -35 215 -130 267 -237 41 -84 60 -223 42 -302 -6 -24 -9 -16 -15 43 -21
200 -122 359 -273 430 -51 23 -70 27 -153 26 -78 0 -107 -5 -162 -27 -95 -37
-173 -93 -264 -189 -43 -46 -65 -65 -49 -43 155 216 342 334 505 320 30 -3 76
-12 102 -21z m494 -1150 c42 -20 74 -63 74 -98 0 -31 -1 -31 -70 -5 -44 18
-78 22 -170 23 -63 0 -144 -3 -180 -7 l-65 -7 60 32 c145 77 273 99 351 62z
m-2218 -511 l94 -48 107 0 c102 0 145 9 255 51 45 17 0 -19 -63 -50 -208 -105
-353 -98 -471 24 -84 86 -61 93 78 23z"/>
<path d="M1990 4405 c-20 -25 -8 -50 25 -50 21 0 31 5 33 18 4 21 -14 47 -33
47 -7 0 -18 -7 -25 -15z"/>
<path d="M2220 4315 c0 -8 5 -15 10 -15 6 0 10 7 10 15 0 8 -4 15 -10 15 -5 0
-10 -7 -10 -15z"/>
<path d="M2183 4273 c9 -2 25 -2 35 0 9 3 1 5 -18 5 -19 0 -27 -2 -17 -5z"/>
<path d="M2103 4263 c9 -2 23 -2 30 0 6 3 -1 5 -18 5 -16 0 -22 -2 -12 -5z"/>
<path d="M2943 4208 c-27 -35 -58 -75 -67 -90 -10 -14 -42 -43 -72 -64 -58
-40 -67 -60 -12 -26 48 30 151 147 202 230 18 29 -4 7 -51 -50z"/>
<path d="M1915 4240 c-38 -10 -81 -23 -95 -29 l-25 -12 25 6 c14 3 69 13 123
22 53 10 97 21 97 25 0 13 -50 8 -125 -12z"/>
<path d="M2272 4248 c6 -18 28 -21 28 -4 0 9 -7 16 -16 16 -9 0 -14 -5 -12
-12z"/>
<path d="M1495 4225 c-113 -24 -236 -84 -372 -182 -71 -50 -84 -67 -22 -27 81
51 238 124 310 144 80 22 188 27 206 9 7 -7 8 -21 3 -40 -10 -34 -2 -36 33 -9
52 41 43 92 -21 110 -46 12 -61 12 -137 -5z"/>
<path d="M2045 4163 c-62 -19 -63 -20 -39 -38 29 -22 65 -18 96 12 48 46 33
53 -57 26z"/>
<path d="M2770 4130 c0 -24 29 -38 40 -20 12 19 1 40 -21 40 -12 0 -19 -7 -19
-20z"/>
<path d="M2129 4103 l-24 -28 28 24 c25 23 32 31 24 31 -2 0 -14 -12 -28 -27z"/>
<path d="M2688 4119 c-10 -6 -18 -17 -18 -24 0 -20 39 -19 47 1 8 22 -8 35
-29 23z"/>
<path d="M1788 4105 c-123 -45 -228 -174 -228 -281 0 -101 82 -180 160 -152
29 10 60 46 60 71 0 8 -18 19 -39 26 -93 27 -109 154 -29 228 58 54 174 79
245 52 34 -12 93 -68 93 -87 0 -7 5 -10 11 -6 15 9 4 59 -22 96 -44 61 -162
86 -251 53z"/>
<path d="M1394 4056 c-132 -28 -199 -49 -279 -89 -193 -96 -339 -249 -408
-427 -35 -90 -47 -225 -27 -311 16 -72 72 -187 114 -238 34 -40 34 -42 20 -76
-8 -19 -14 -53 -14 -76 0 -54 36 -88 132 -123 107 -40 198 -56 306 -55 157 2
173 14 27 21 -136 6 -190 19 -297 73 -68 34 -96 60 -119 110 -34 74 -24 82 35
28 174 -159 331 -200 537 -139 82 24 220 82 169 71 -135 -30 -188 -37 -265
-38 -218 -2 -354 79 -445 267 -113 232 -84 473 78 648 131 142 301 198 467
155 l50 -13 -3 59 c-4 68 18 139 51 162 20 14 21 15 2 14 -11 0 -70 -11 -131
-23z m-594 -510 c-44 -104 -51 -275 -17 -388 8 -27 13 -48 10 -48 -2 0 -18 30
-36 68 -29 60 -32 76 -31 157 0 94 9 126 60 213 32 54 38 54 14 -2z"/>
<path d="M2660 3985 c0 -5 5 -17 10 -25 5 -8 10 -10 10 -5 0 6 -5 17 -10 25
-5 8 -10 11 -10 5z"/>
<path d="M1864 3950 c-30 -12 -64 -58 -64 -87 0 -31 25 -79 45 -87 26 -10 60
-7 73 6 19 19 15 48 -7 48 -34 0 -51 12 -51 36 0 22 25 44 49 44 28 0 51 -41
52 -92 l1 -53 19 43 c25 54 18 92 -23 127 -30 26 -57 30 -94 15z"/>
<path d="M2761 3923 c-21 -48 -163 -282 -178 -295 -8 -6 -31 -15 -51 -19 -35
-6 -35 -7 -7 -8 44 -2 70 21 131 116 58 89 128 222 121 229 -2 2 -9 -8 -16
-23z"/>
<path d="M2563 3920 c-12 -5 -29 -20 -38 -34 -22 -33 -9 -76 29 -94 23 -12 32
-11 64 5 40 20 60 60 24 51 -41 -11 -75 44 -36 59 13 5 13 7 2 14 -16 10 -17
10 -45 -1z"/>
<path d="M2931 3807 c-27 -45 -83 -155 -124 -244 -149 -323 -244 -407 -557
-493 -125 -35 -122 -43 10 -37 174 7 293 57 400 167 91 93 155 219 239 468 23
68 53 146 66 173 38 75 22 59 -34 -34z"/>
<path d="M2496 3749 c16 -18 82 -45 89 -37 3 2 -20 15 -50 29 -44 20 -52 22
-39 8z"/>
<path d="M1490 3744 c0 -17 53 -86 91 -118 92 -78 223 -79 307 -2 49 44 44 56
-9 23 -49 -30 -58 -32 -143 -32 -74 0 -98 4 -131 22 -41 22 -84 62 -103 98 -6
11 -12 15 -12 9z"/>
<path d="M2200 3700 c-12 -8 -9 -10 12 -10 35 0 53 -30 34 -55 -8 -11 -19 -16
-30 -12 -10 4 -15 3 -11 -3 10 -17 33 -11 49 12 12 16 13 26 4 42 -18 35 -34
42 -58 26z"/>
<path d="M1123 3654 c-48 -24 -68 -53 -96 -139 -55 -168 -62 -350 -18 -450 52
-118 147 -204 246 -225 115 -24 228 17 450 162 153 101 209 130 330 174 50 18
85 33 78 34 -20 0 -154 -50 -226 -86 -37 -18 -120 -68 -183 -109 -141 -92
-216 -130 -291 -150 -99 -26 -180 -15 -230 31 -23 20 -24 23 -6 15 32 -16 152
-13 214 5 68 20 174 73 312 158 60 36 142 78 183 93 40 16 74 31 74 34 0 3
-53 12 -117 19 -219 24 -301 55 -488 180 -55 37 -124 79 -152 93 l-52 27 -20
-26 c-11 -14 -27 -48 -37 -76 -33 -100 3 -196 91 -238 81 -39 168 -45 380 -27
103 9 190 15 193 12 5 -5 -198 -140 -258 -170 -128 -65 -265 -83 -347 -46 -85
39 -144 169 -145 316 0 87 21 162 65 231 32 52 89 165 85 169 -2 2 -17 -3 -35
-11z m158 -291 c35 -26 98 -69 139 -95 l75 -49 -45 7 c-176 24 -270 74 -270
144 0 54 20 53 101 -7z"/>
<path d="M1288 3653 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z"/>
<path d="M2402 3586 c-33 -75 -74 -121 -138 -152 -49 -24 -63 -26 -124 -21
-73 6 -79 2 -60 -34 18 -32 72 -24 153 22 40 23 87 56 105 73 33 31 96 140 90
156 -2 5 -13 -15 -26 -44z"/>
<path d="M2871 3540 c-52 -171 -139 -314 -238 -395 -97 -79 -161 -105 -363
-145 -111 -22 -174 -52 -210 -97 -12 -15 -19 -35 -17 -45 3 -10 0 -18 -6 -18
-30 0 -136 -62 -174 -101 -60 -63 -83 -119 -83 -206 0 -42 4 -73 10 -73 6 0
10 20 10 45 0 61 35 150 78 197 67 74 143 105 393 163 83 19 183 49 222 65 93
39 193 115 262 198 56 68 264 372 293 427 15 30 15 30 -27 -7 -28 -26 -51 -38
-70 -38 -35 0 -43 11 -51 65 l-6 40 -23 -75z m-601 -619 c-15 -9 -170 -61
-180 -61 -24 2 152 70 180 69 13 0 13 -1 0 -8z"/>
<path d="M3700 3570 c-10 -6 -2 -7 25 -3 49 7 58 13 19 13 -16 0 -36 -5 -44
-10z"/>
<path d="M3780 3566 c0 -2 7 -7 16 -10 8 -3 12 -2 9 4 -6 10 -25 14 -25 6z"/>
<path d="M3659 3543 c-13 -16 -12 -17 4 -4 16 13 21 21 13 21 -2 0 -10 -8 -17
-17z"/>
<path d="M2397 3412 c-21 -23 -22 -56 -1 -76 21 -21 47 -20 67 2 23 26 21 58
-5 76 -29 21 -41 20 -61 -2z"/>
<path d="M3907 3396 c-12 -31 -95 -59 -177 -60 -61 -1 -82 3 -114 22 l-39 23
15 -23 c30 -45 66 -63 126 -62 91 2 213 66 200 105 -3 9 -7 7 -11 -5z"/>
<path d="M3760 3380 c-21 -7 -21 -8 -5 -9 11 0 27 4 35 9 18 11 5 11 -30 0z"/>
<path d="M616 3205 c-9 -26 -7 -32 5 -12 6 10 9 21 6 23 -2 3 -7 -2 -11 -11z"/>
<path d="M2105 3144 c-32 -36 -110 -109 -174 -163 -121 -102 -191 -173 -191
-193 0 -6 -2 -9 -5 -6 -3 3 8 38 25 78 37 89 37 95 4 47 -65 -96 -96 -203 -95
-333 0 -195 68 -343 228 -494 120 -113 170 -134 57 -24 -107 105 -168 192
-203 288 -22 60 -26 88 -26 181 0 105 2 114 34 179 28 57 61 96 190 225 95 95
169 178 190 214 19 32 32 60 29 63 -3 2 -31 -25 -63 -62z"/>
<path d="M3648 3161 c-53 -27 -136 -76 -185 -109 -82 -57 -393 -329 -438 -383
-24 -29 -27 -32 165 137 246 216 310 263 484 355 118 63 99 62 -26 0z"/>
<path d="M577 3083 c-58 -196 -82 -373 -73 -543 3 -69 10 -141 16 -160 7 -27
9 -13 6 65 -8 213 19 477 65 643 29 105 17 100 -14 -5z"/>
<path d="M2929 3118 c-7 -18 -55 -74 -106 -125 -51 -51 -93 -99 -93 -108 0
-56 151 70 199 167 31 61 39 98 22 98 -5 0 -14 -15 -22 -32z"/>
<path d="M736 2923 c-32 -95 -53 -246 -40 -288 8 -27 9 -25 11 25 5 86 22 188
44 263 28 95 17 95 -15 0z"/>
<path d="M3878 2813 c6 -2 18 -2 25 0 6 3 1 5 -13 5 -14 0 -19 -2 -12 -5z"/>
<path d="M3828 2803 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z"/>
<path d="M4080 2796 c-82 -31 -148 -73 -321 -209 -208 -162 -470 -360 -574
-433 l-70 -49 104 130 c58 72 132 162 165 200 74 85 90 105 83 105 -12 0 -197
-215 -283 -330 -77 -102 -106 -132 -161 -167 -75 -49 -76 -55 -2 -18 170 87
550 333 798 518 79 59 162 118 185 132 187 108 422 48 512 -131 14 -27 22 -38
18 -24 -25 96 -118 205 -216 255 -60 30 -80 35 -137 34 -36 0 -82 -6 -101 -13z"/>
<path d="M3720 2776 c-110 -39 -268 -129 -365 -209 -261 -216 -625 -565 -625
-600 0 -5 64 51 143 124 234 218 506 458 595 524 92 68 212 136 294 165 29 10
46 19 38 19 -8 0 -44 -10 -80 -23z"/>
<path d="M1507 2683 c-38 -60 -49 -108 -45 -187 3 -59 10 -86 41 -149 82 -166
310 -419 439 -487 54 -29 90 -61 198 -179 96 -104 140 -160 161 -205 33 -71
38 -56 10 30 -23 70 -50 133 -51 119 0 -13 -35 44 -77 128 -48 95 -81 129
-181 184 -147 81 -373 324 -458 493 -35 70 -45 194 -21 253 20 47 14 47 -16 0z"/>
<path d="M4093 2685 c-80 -22 -123 -47 -261 -152 -227 -172 -275 -208 -427
-313 -172 -119 -224 -169 -280 -266 -22 -38 -59 -90 -82 -116 -40 -45 -73 -97
-73 -115 0 -4 15 15 34 43 55 82 214 204 330 253 152 66 292 38 399 -79 46
-51 117 -176 117 -208 0 -8 9 -16 19 -19 24 -6 31 -31 31 -108 0 -182 -116
-355 -358 -538 -151 -113 -291 -167 -432 -167 -132 0 -238 43 -341 137 -60 55
-61 56 -29 14 47 -58 137 -125 208 -152 78 -30 242 -38 333 -15 217 54 507
281 607 475 55 104 72 169 72 267 0 137 -47 232 -198 399 -104 114 -126 157
-120 232 5 55 6 58 84 133 111 107 229 199 294 229 148 68 316 1 389 -155 11
-23 24 -62 27 -86 4 -24 11 -46 17 -49 16 -11 20 -91 8 -164 -5 -38 -9 -71 -6
-73 9 -9 26 80 31 163 5 86 -10 176 -41 249 -16 36 14 7 35 -34 30 -59 45
-172 32 -245 -5 -33 -8 -62 -7 -64 12 -12 30 100 30 184 0 89 -3 106 -27 156
-15 30 -45 73 -65 94 -83 83 -235 123 -350 90z m-494 -470 l0 -65 -53 0 c-29
0 -69 -2 -87 -5 l-34 -6 25 18 c14 10 52 41 85 70 33 28 61 52 62 52 1 1 1
-28 2 -64z"/>
<path d="M860 2648 c0 -15 53 -126 97 -202 26 -43 77 -111 114 -151 69 -74 95
-112 85 -122 -3 -4 -59 47 -124 113 -99 100 -125 132 -160 203 -23 46 -42 90
-42 97 0 8 -4 14 -8 14 -7 0 -26 -48 -48 -119 -3 -9 -30 11 -80 59 -41 40 -77
70 -81 67 -22 -23 188 -238 539 -549 86 -76 159 -146 162 -154 3 -9 6 -26 6
-39 0 -45 40 -152 80 -213 56 -87 181 -214 349 -356 79 -66 176 -148 216 -182
178 -150 369 -255 650 -357 269 -97 332 -111 500 -112 215 0 291 26 630 218
322 182 441 274 563 436 119 157 225 411 263 631 17 97 20 137 14 260 -4 80
-11 168 -15 195 -7 40 -8 33 -4 -30 6 -94 -9 -258 -37 -403 -54 -279 -185
-547 -347 -709 -80 -80 -158 -135 -324 -229 -73 -42 -170 -98 -215 -126 -195
-117 -336 -162 -508 -161 -133 0 -225 23 -354 87 -205 104 -356 264 -507 540
-31 56 -77 120 -124 170 -41 45 -98 108 -125 141 -28 32 -83 95 -123 138 -52
55 -72 84 -69 97 5 19 -6 26 -86 50 -71 22 -186 159 -248 295 -40 88 -63 212
-56 304 5 76 5 76 -11 41 -23 -51 -27 -184 -8 -261 9 -35 36 -104 60 -154 77
-154 183 -268 356 -381 135 -87 229 -215 326 -443 47 -110 109 -220 177 -311
29 -39 33 -48 14 -31 -15 14 -27 21 -27 17 0 -11 -39 12 -145 88 -166 117
-308 264 -480 496 -84 113 -135 175 -135 164 0 -9 181 -261 252 -351 140 -176
274 -295 511 -452 75 -50 137 -93 137 -96 0 -7 -145 60 -207 96 -140 81 -318
230 -432 364 -179 210 -371 472 -371 506 0 7 140 -50 240 -97 93 -44 221 -133
299 -208 74 -70 74 -70 40 -22 -70 100 -261 248 -444 342 -208 108 -290 170
-360 273 -80 118 -115 267 -81 350 31 78 12 125 -48 119 -23 -2 -33 -10 -40
-31 -9 -23 -6 -36 16 -75 24 -44 48 -138 48 -186 -1 -44 -180 170 -236 283
-18 36 -33 63 -34 59z m571 -799 c5 -8 22 -44 39 -81 29 -63 207 -306 308
-420 l47 -53 -50 41 c-141 117 -323 328 -361 419 -27 66 -12 149 17 94z"/>
<path d="M4080 2509 c-155 -70 -226 -277 -138 -403 15 -20 16 -26 6 -18 -28
22 -58 96 -68 164 l-9 63 3 -67 c8 -146 116 -246 253 -235 98 7 181 65 208
144 12 33 14 36 22 18 4 -11 8 -85 8 -165 -1 -129 -4 -156 -29 -240 -93 -320
-270 -532 -662 -797 -143 -95 -231 -142 -329 -173 -89 -27 -241 -37 -327 -20
-235 46 -473 221 -608 449 -29 50 -55 91 -58 91 -9 0 82 -156 122 -208 53 -69
155 -167 216 -209 249 -169 543 -193 805 -64 161 79 422 254 558 374 136 120
278 349 326 527 79 294 33 561 -114 658 -133 88 -281 -20 -221 -161 20 -48 50
-70 96 -70 67 0 112 59 90 117 -12 33 -53 59 -80 51 -27 -9 -26 -25 3 -25 32
0 47 -18 47 -55 0 -93 -127 -83 -146 11 -15 76 50 141 133 131 79 -9 128 -75
121 -164 -8 -93 -72 -153 -165 -153 -62 0 -100 17 -137 60 -90 108 -39 292 99
356 95 45 182 22 270 -69 51 -54 45 -38 -9 22 -70 76 -193 102 -286 60z"/>
<path d="M1307 2474 c-9 -17 -34 -43 -56 -57 -39 -26 -50 -45 -34 -60 3 -4 13
-1 22 7 9 8 39 23 66 33 57 21 68 45 37 83 l-19 24 -16 -30z"/>
<path d="M4541 2485 c1 -19 18 -51 18 -35 0 8 -4 22 -9 30 -5 8 -9 11 -9 5z"/>
<path d="M681 2311 c-1 -59 6 -95 35 -180 70 -210 226 -479 378 -653 146 -168
321 -308 383 -308 46 0 24 37 -74 126 -327 294 -614 710 -702 1020 l-20 69 0
-74z"/>
<path d="M3881 2344 c0 -11 3 -14 6 -6 3 7 2 16 -1 19 -3 4 -6 -2 -5 -13z"/>
<path d="M1280 2312 c0 -21 17 -44 71 -97 38 -39 102 -112 141 -163 87 -114
107 -129 41 -31 -27 41 -75 117 -106 169 -38 64 -69 104 -96 123 -21 15 -42
27 -45 27 -3 0 -6 -12 -6 -28z"/>
<path d="M3671 2289 c-28 -80 -8 -120 128 -263 165 -172 216 -260 228 -395 l6
-66 15 35 c22 52 18 138 -8 189 -12 24 -61 84 -108 134 l-87 90 55 -35 c73
-45 100 -56 158 -64 68 -9 147 16 197 61 39 35 39 36 5 12 -69 -49 -103 -61
-170 -61 -81 0 -142 27 -256 111 -131 98 -175 168 -154 243 13 44 6 51 -9 9z
m174 -278 c-3 -3 -18 8 -33 23 l-27 29 32 -23 c18 -13 30 -26 28 -29z"/>
<path d="M822 2260 c0 -14 2 -19 5 -12 2 6 2 18 0 25 -3 6 -5 1 -5 -13z"/>
<path d="M830 2219 c0 -33 53 -177 105 -286 30 -62 56 -113 59 -113 2 0 -18
47 -45 105 -27 58 -65 151 -84 208 -19 56 -35 95 -35 86z"/>
<path d="M550 2124 c0 -6 18 -67 40 -135 48 -146 128 -317 203 -432 60 -93
183 -242 248 -302 24 -22 12 -6 -27 36 -39 42 -99 118 -133 170 -77 117 -218
395 -282 554 -27 66 -48 115 -49 109z"/>
<path d="M982 2068 c-29 -29 -1 -75 38 -63 17 5 20 13 18 38 -3 35 -33 48 -56
25z"/>
<path d="M4312 1987 c-45 -182 -140 -356 -275 -506 -67 -74 -152 -199 -142
-209 8 -8 101 67 166 135 98 103 178 231 218 351 21 61 65 296 59 313 -2 4
-13 -33 -26 -84z"/>
<path d="M1152 1958 c-7 -7 -12 -17 -12 -23 0 -10 43 -54 113 -115 l27 -24
-20 59 c-20 58 -62 115 -85 115 -6 0 -16 -5 -23 -12z"/>
<path d="M2975 1876 c-163 -52 -274 -185 -283 -338 -9 -143 67 -250 208 -292
67 -20 110 -20 185 -1 126 33 215 128 215 229 0 56 -18 94 -60 130 -56 46
-153 29 -185 -34 -23 -45 -18 -51 14 -19 29 28 61 36 96 23 26 -10 48 -62 41
-99 -25 -129 -230 -170 -340 -67 -125 118 -64 310 139 439 68 43 54 56 -30 29z"/>
<path d="M2299 1857 c-31 -21 -34 -27 -31 -66 2 -23 9 -59 16 -79 l13 -37 8
65 c4 36 16 79 26 96 31 52 22 58 -32 21z"/>
<path d="M3502 1783 c49 -53 83 -111 104 -178 7 -22 13 -33 13 -24 3 55 -73
187 -131 229 -27 19 -25 15 14 -27z"/>
<path d="M3120 1765 c-90 -29 -180 -140 -180 -222 0 -45 23 -97 51 -117 36
-25 95 -21 124 9 14 13 25 29 25 34 0 6 -11 -1 -25 -14 -28 -29 -42 -31 -72
-10 -35 24 -47 85 -27 134 41 104 162 138 248 70 18 -14 34 -19 54 -15 44 10
112 -30 139 -83 70 -134 -16 -299 -202 -388 -85 -40 -204 -67 -258 -57 -56 9
-39 -12 25 -31 76 -22 211 -20 294 6 185 57 427 225 495 343 31 56 41 90 10
41 -40 -67 -141 -127 -235 -141 -46 -6 -49 -5 -42 12 17 44 28 133 22 182 -12
104 -77 191 -175 235 -59 27 -206 33 -271 12z"/>
<path d="M2227 1696 c15 -30 29 -54 31 -52 5 5 -39 95 -49 102 -5 3 3 -19 18
-50z"/>
<path d="M1720 1676 c0 -3 9 -10 20 -16 11 -6 20 -8 20 -6 0 3 -9 10 -20 16
-11 6 -20 8 -20 6z"/>
<path d="M1775 1643 c6 -5 46 -36 90 -68 136 -102 214 -188 329 -362 59 -89
113 -166 121 -173 30 -25 -218 337 -263 384 -51 53 -229 198 -265 217 -12 6
-17 7 -12 2z"/>
<path d="M3806 1598 c-17 -29 -58 -82 -93 -117 -34 -36 -60 -67 -58 -69 7 -8
77 42 122 87 43 43 67 95 61 131 -2 16 -10 8 -32 -32z"/>
<path d="M886 1584 c-9 -8 -16 -21 -16 -27 0 -20 38 -75 63 -92 23 -14 57 -12
57 5 0 13 -73 130 -81 130 -4 0 -15 -7 -23 -16z"/>
<path d="M3623 1520 c0 -25 2 -35 4 -22 2 12 2 32 0 45 -2 12 -4 2 -4 -23z"/>
<path d="M3110 1526 c0 -2 7 -7 16 -10 8 -3 12 -2 9 4 -6 10 -25 14 -25 6z"/>
<path d="M1145 1165 c-36 -35 -34 -88 4 -126 36 -36 70 -37 110 -3 35 29 27
32 170 -61 91 -60 299 -175 316 -175 24 0 -34 38 -159 106 -211 114 -286 163
-286 186 0 28 -27 76 -49 88 -34 18 -80 12 -106 -15z"/>
<path d="M1650 1116 c0 -2 31 -23 69 -46 47 -28 71 -49 73 -63 2 -14 10 -22
23 -22 26 0 27 38 1 43 -10 2 -42 19 -70 36 -61 39 -96 58 -96 52z"/>
<path d="M1525 1051 c-9 -16 3 -31 26 -31 14 0 19 6 17 17 -4 20 -33 29 -43
14z"/>
<path d="M2030 935 c0 -4 14 -34 32 -67 51 -97 135 -150 350 -224 143 -49 247
-68 375 -69 92 0 115 3 129 17 37 36 -2 52 -179 73 -166 19 -280 49 -433 115
-135 58 -190 88 -239 132 -19 16 -35 27 -35 23z"/>
<path d="M1848 755 c-10 -22 -9 -29 10 -47 18 -19 25 -20 47 -10 44 20 28 82
-22 82 -15 0 -27 -9 -35 -25z"/>
<path d="M2057 713 c-4 -3 -7 -19 -7 -34 0 -31 28 -53 54 -43 22 8 31 51 16
69 -13 15 -51 20 -63 8z"/>
<path d="M2688 703 c7 -3 16 -2 19 1 4 3 -2 6 -13 5 -11 0 -14 -3 -6 -6z"/>
</g>
</svg>`
    
    // 保存原始SVG代码
    svgRawContent.value = svgContent.trim()
    
    const blob = new Blob([svgContent], { type: 'image/svg+xml' })
    return URL.createObjectURL(blob)
  } else {
    // PNG模拟数据 - 使用 picsum 作为示例图片
    const width = 400
    const height = 400
    const seed = Math.floor(Math.random() * 1000)
    return `https://picsum.photos/seed/${seed}/${width}/${height}`
  }
}

// 监听visible变化
watch(() => props.visible, (newVal) => {
  if (!newVal) {
    // 弹窗关闭时重置状态
    setTimeout(() => {
      prompt.value = ''
      previewUrl.value = ''
      isGenerating.value = false
    }, 300)
  }
})
</script>

<style scoped>
.ai-generate-dialog {
  position: relative;
  z-index: 1000;
}

.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.dialog-content {
  background: white;
  border-radius: 12px;
  width: 90%;
  max-width: 900px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
  animation: dialogSlideIn 0.3s ease-out;
}

@keyframes dialogSlideIn {
  from {
    opacity: 0;
    transform: translateY(-20px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.dialog-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 20px 24px;
  border-bottom: 1px solid #e5e7eb;
}

.dialog-title {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
}

.close-btn {
  background: none;
  border: none;
  font-size: 24px;
  color: #6b7280;
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  transition: all 0.2s;
}

.close-btn:hover {
  background: #f3f4f6;
  color: #374151;
}

.dialog-body {
  padding: 24px;
}

.dialog-content-wrapper {
  display: flex;
  gap: 24px;
  min-height: 400px;
}

.form-section {
  flex: 1;
  min-width: 0;
}

.preview-section {
  flex: 1;
  min-width: 300px;
  display: flex;
  flex-direction: column;
}

.form-group {
  margin-bottom: 24px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: #374151;
  font-size: 14px;
}

.model-selector {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.model-option {
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  padding: 16px;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 12px;
}

.model-option:hover {
  border-color: #d1d5db;
  background: #f9fafb;
}

.model-option.active {
  border-color: #3b82f6;
  background: #eff6ff;
}

.model-icon {
  font-size: 24px;
  flex-shrink: 0;
}

.model-info {
  flex: 1;
}

.model-name {
  font-weight: 500;
  color: #1f2937;
  margin-bottom: 4px;
}

.model-desc {
  font-size: 12px;
  color: #6b7280;
}

.prompt-input {
  width: 100%;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  padding: 12px;
  font-size: 14px;
  line-height: 1.5;
  resize: vertical;
  min-height: 100px;
  transition: border-color 0.2s;
}

.prompt-input:focus {
  outline: none;
  border-color: #3b82f6;
}

.input-hint {
  margin-top: 6px;
  font-size: 12px;
  color: #6b7280;
}

.generate-btn {
  width: 100%;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 12px 24px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.generate-btn:hover:not(:disabled) {
  background: #2563eb;
}

.generate-btn:disabled {
  background: #d1d5db;
  cursor: not-allowed;
}

.preview-section .form-label {
  margin-bottom: 12px;
}

.preview-container {
  border: 2px dashed #d1d5db;
  border-radius: 8px;
  padding: 24px;
  text-align: center;
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 300px;
}

.preview-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  color: #9ca3af;
}

.placeholder-icon {
  font-size: 48px;
  opacity: 0.5;
}

.placeholder-text {
  font-size: 14px;
  color: #6b7280;
}

.preview-loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 16px;
  color: #6b7280;
}

.loading-text {
  font-size: 14px;
}

.preview-image-wrapper {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  width: 100%;
}

.preview-image {
  max-width: 100%;
  max-height: 250px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  object-fit: contain;
}

.preview-info {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
}

.model-tag {
  background: #3b82f6;
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}

.size-info {
  color: #6b7280;
  font-size: 12px;
}

.loading-spinner {
  width: 16px;
  height: 16px;
  border: 2px solid #e5e7eb;
  border-top: 2px solid #3b82f6;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.loading-spinner.large {
  width: 32px;
  height: 32px;
  border-width: 3px;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

.dialog-footer {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  padding: 20px 24px;
  border-top: 1px solid #e5e7eb;
  background: #f9fafb;
  border-radius: 0 0 12px 12px;
}

.btn {
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
}

.btn-secondary {
  background: #f3f4f6;
  color: #374151;
}

.btn-secondary:hover {
  background: #e5e7eb;
}

.btn-primary {
  background: #3b82f6;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: #2563eb;
}

.btn-primary:disabled {
  background: #d1d5db;
  cursor: not-allowed;
}

/* 响应式设计 */
@media (max-width: 768px) {
  .dialog-content {
    max-width: 95%;
    margin: 20px;
  }
  
  .dialog-content-wrapper {
    flex-direction: column;
    min-height: auto;
  }
  
  .preview-section {
    min-width: auto;
    margin-top: 20px;
  }
  
  .preview-container {
    min-height: 200px;
  }
}
</style>
