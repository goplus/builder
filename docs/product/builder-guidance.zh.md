# Builder 向导

Builder向导通过设计一个有趣、功能完整且具有故事剧情的游戏项目，采用各种交互式、跟随式引导，旨在引导零编程基础的新用户快速上手Builder产品和Go+语言。用户完成本向导后，可以得到一个小游戏，能够在其上面自由发挥并发布到社区。

向导是一个入门级课程，教授Go+基本语法和快速上手Go+Builder。实际上，向导部分的产品设计具有很高的可扩展性，后续各种项目式、任务式课程均可采用此设计，即后续可引入多条故事线来丰富Builder的课程体系，我们后续也会开发一个用于开发Builder课程的效率工具，方便课程设计师打造精品课程。

Go+Builder使用文本编程开发游戏，和积木式编程有很大的不同，在整个向导过程中用户需要完成的绝大多数任务都是编写Go+代码，同时为了降低零编程基础用户上手的心智负担，Builder向导将观看视频+代码完形填空作为主要的引导方式。此外也会有UI引导帮助用户上手Builder的IDE。

## 基本概念

### 故事线

Builder向导引入故事线的概念，以一个故事剧情作为主线（牛小七救公主）贯穿整个向导，用户完成向导后可得到一个具有故事线的小游戏。

整个故事线被划分为多个关卡，在UI上体现为一个关卡list列表，采用地图的方式进行展示（城堡、勇士牛小七路线图等等）：

- 关卡之间有严格的先后顺序，前一关完成后才能解锁进入下一关。

- 完成指定关卡获得对应成就：这里的成就不是全局用户意义上成就，只是本向导下的成就，但依然要和用户绑定，比如“护花使者牛小七”、“英雄牛小七”、“屠龙战士牛小七”等

- 完成指定关卡获得指定限定素材（与素材库联动）：用户在完成向导的过程中，会涉及添加各种素材（精灵素材、声音素材、场景素材等），所需要使用的精美素材由我们提供，用户完成某个关卡后该关卡用到的素材免费送给用户，用户后续可以在自己的素材库中使用他们，添加进自己的Builder项目中。

用户首次进入一个故事线时为用户创建一个该故事线下的Project（假设叫它A，基本信息预设提供），不同的故事线之间是独立的，一个故事线对应一个A，这个 A 的 Name、Description等基本信息使用对应故事线的信息来构造。用户后续进入关卡(包括已完成的关卡和未完成的关卡)打开的Project就是A。

用户完成最后一关时，再为用户创建一个Project（假设叫它B），B会包含整个故事线的完整Project内容，用户后续可自行在B上自由发挥。一个故事线对应一个B，允许多次完成同一个故事线（其实就是允许多次完成一个故事线的最后一关），但是仅在首次完成时创建Project B。

用户首次进入一个故事线的第一关时构造出的Project A 保存到云端，这个A不是用户账号下的一个普通 Project，与普通Project的区别在于A不展示在用户的项目列表中，但是B是用户账号下的一个普通 Project（即需要对现有的 Project 引入额外的信息，用于标记它是否“普通”。“普通”就展示在用户的项目列表中，“特殊”就不展示在用户的项目列表中）。

## 关卡

关卡是故事线的具体展现形式，是故事线中独立的操作任务，每个关卡之间有很强的先后逻辑顺序（保证故事线的连贯和编程知识的循序渐进、由浅入深）。

用户点击进入一个关卡会打开用户在该故事线下面的Project A（用户在这个关卡中的所有操作（写代码和添加素材）都会自动保存到云端Project A中），然后弹出本关的关卡介绍，介绍本关需要完成的任务（以列表形式呈现本关各个节点任务的标题），用户点击“开始”后，开始依次进入每个节点任务，观看视频完成步骤，即：

- 一个关卡有多个节点任务，节点任务之间有严格的先后顺序，用户只有完成该节点任务才可进入下一节点任务

- 一个节点任务有一个视频，观看完视频才可进行步骤的完成

- 一个节点任务有一个或多个步骤，用户完成所有步骤后即可完成该节点任务。当所有节点任务完成，本关通关解锁下一关。

用户观看的视频进度条不允许拖拽只允许暂停，且当用户在观看视频的过程中，应该禁止用户对当前Builder项目的更改，只有用户进入步骤时，才能在我们开放的区域对Builder项目进行更改。用户也可以跳过当前观看的视频，直接来到第一个步骤。

一个关卡只提供本关卡所需的spx API：

- 这样做的考虑：

  - 简化实现，取消使用UI高亮引导用户点击API

  - 可以将整个spx API区域和代码编辑区域开放给用户，用户操作更接近实际开发

  - 只提供需要的，降低用户查询所需API的心智负担

  - 编码式步骤中具体会用到哪个API，该步骤下的content会明确指出

这种“隐藏”原有编辑器列表展示的行为，也会在向导的其他地方体现：

  - IDE中精灵素材列表的隐藏

  - IDE中声音素材列表的隐藏

  - IDE中舞台背景素材列表的隐藏

  - IDE中精灵动画列表的隐藏（造型+骨骼动画）

  - IDE中控件列表的隐藏

  - 素材库素材列表的隐藏

## 步骤

步骤是用户完成一次操作的最小单位，分为Coding步骤和跟随式步骤（后续也可以扩展其他步骤）。

### Coding步骤

开放代码编辑区域与spx API区域让用户写代码，需要定位代码编辑区域的位置并将其高亮展示（其他区域蒙层禁止用户操作）。为了尽可能降低用户上手难度，采用“完形填空”的方式。

完形填空：Coding步骤需要存储一个步骤初始快照和一个步骤结束快照（均仅为Project的Game（游戏内容））：

- 步骤结束快照中会有部分代码是答案代码，即用户通过本步骤需要添加的代码。

- 步骤初始快照中对应答案代码的部分是挖了空的待补全代码（模板代码）
该步骤开始时，Builder会重新加载步骤初始快照以替换编辑器当前的Game游戏内容，用户在提供的模板代码上补全并通过检测即可完成该步骤。

Coding步骤会提供如下交互选项：

- 代码检测：用户点击代码检测后，会将编辑器当前的快照和步骤结束快照进行比对（格式化后字符串比对）。通过比对后就算通过了检测。如果没有通过比对，就调用后端接口借助大模型进行比对。

- 查看答案：查看答案代码

- 查看content步骤详情：包含本步骤的指导信息

### 跟随式步骤

主要借助UI引导的方式，引导用户跟随式操作。

跟随式步骤可能出现的场景：

- 引导用户切换到指定精灵或舞台的代码编辑

- 引导用户操作舞台（添加背景、添加控件）

- 引导用户添加声音

- 引导用户添加精灵

- 引导用户图形化操作精灵

- 引导用户添加精灵动画（造型组动画和骨骼动画）

- 引导用户运行项目

UI引导在引导中通过多种手段引导用户完成跟随式操作：

- UI高亮

- 箭头指引

- 图文呈现

- 精灵素材图

- 蒙层（限制用户操作）

跟随式步骤的粒度：在一个添加精灵的操作中，实际上应该至少划分为四个跟随式步骤：

- 引导用户点击添加精灵按钮（+号）

- 引导用户点击“从素材库选择”

- 引导用户点击指定精灵素材

- 引导用户点击确认按钮

根据上述的“粒度”可以发现，有些跟随式步骤是会改变Builder项目状态的，而有些是不会改变的。而对于会改变Builder项目状态的那些跟随式步骤，需要对改变后的状态进行检测以判断用户是否可以通过该步骤，即需要存储一个步骤结束快照，用于快照比对（格式化后字符串比对）。

## 关卡编辑器

关卡编辑器旨在为向导创建故事线内容。关卡编辑器的最大编辑单位为故事线。故事线由一个管理平台进行管理，故事线内部可以创建多个关卡，每个关卡下可以新建多个节点任务，每个节点需要上传当前节点任务对应的视频，并且包含一个或多个步骤，步骤类型可以为coding类型或者following类型。

关卡编辑器与ProjectEditor存在高度的交互，出题人的出题流程完全模拟做题人的流程，故关卡编辑器对步骤的编辑会直接在ProjectEditor上进行。

### 故事线管理平台

故事线管理平台对故事线进行管理，符合常规增删改查的管理流程。目前该平台对所有用户开放。从故事线跳转至故事线编辑页面，有两个通道，分别为新建和编辑。
* 新建通道：可以选择已存在的项目或新建项目。选择一个项目对当前故事线进行绑定，后续的故事线、关卡等编辑都围绕这个绑定的项目进行。
* 编辑通道：之前编辑的故事线已绑定过一个项目，点击该故事线卡片编辑按钮后，进入已绑定的项目并开启故事线编辑模式。

### 故事线编辑
故事线编辑需要出题人录入故事线的信息，完成基本信息录入之后可以创建关卡，进入关卡编辑页面。
在故事线编辑页面，可以通过保存按钮将当前整个故事线保存至云端。

### 关卡编辑、节点任务编辑、步骤编辑
这三类编辑需要出题人以填写表单的形式录入关卡、节点、步骤各项信息的中英文信息。在上一级的编辑页面中，可以直接创建一个或多个下一级的引导单元（这里的引导单元即“关卡”、“节点任务”、“步骤”），如在一个关卡编辑中可以创建多个节点任务，在一个节点任务编辑中可以创建多个步骤，引导单元创建成功后，可以通过icon进入并对该单元的基本信息进行编辑。
#### 关卡编辑：
关卡基本信息
#### 节点任务编辑：
节点任务基本信息
视频信息
#### 步骤编辑：
步骤编辑是关卡编辑器中的需要编辑部分的最小单位，分为 Coding 步骤和 Following 步骤的编辑。步骤编辑部分需要完成的内容包括：
* 步骤基本信息编辑
* 步骤需要控制的 API 或者素材的编辑
* 步骤初始快照和结束快照的编辑
* 两个不同类型的步骤的编辑：
  * Coding 步骤：主要包括完形填空中一个或者多个“挖空”的位置编辑、答案代码的编辑
  * Following 步骤：通过可视化选择语义化标注内容的方式实现，期望的实现方式类似于 VueDevTools 的 Select Component 功能，于前者不同的是，在 GuidnaceEditor 中，所选择的不是所有组件，而是已经通过语义化标注过的组件。